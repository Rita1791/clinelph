<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Clinelph | Login</title>

  <!-- PWA -->
  <link rel="manifest" href="manifest.json">
  <meta name="theme-color" content="#0b5ed7">

  <!-- CSS -->
  <link rel="stylesheet" href="css/main.css">
</head>

<body>

  <div style="max-width:400px;margin:80px auto;background:#fff;padding:20px;border:1px solid #ccc;">
    <h2>Clinelph</h2>
    <p>Clinical Trial Management System</p>

    <label>Email ID</label>
    <input type="email" id="email" placeholder="user@cro.com">

    <label>Role</label>
    <select id="role">
      <option value="">Select Role</option>
      <option>Sponsor</option>
      <option>Principal Investigator</option>
      <option>Study Director</option>
      <option>Clinical Research Coordinator</option>
      <option>QA/QC</option>
      <option>Doctor</option>
      <option>Phlebotomist</option>
    </select>

    <button onclick="login()">Login</button>

    <p id="error" style="color:red;"></p>
  </div>

  <!-- JS -->
  <script src="js/db.js"></script>
  <script src="js/auth.js"></script>

  <script>
    function login() {
      const email = document.getElementById("email").value;
      const role = document.getElementById("role").value;
      const error = document.getElementById("error");

      if (!email || !role) {
        error.innerText = "Email and role are required";
        return;
      }

      // official email check
      if (
        !email.endsWith("@cro.com") &&
        !email.endsWith("@hospital.org") &&
        !email.endsWith("@research.com")
      ) {
        error.innerText = "Only official email IDs allowed";
        return;
      }

      loginUser(email, role);
      window.location.href = "dashboard.html";
    }

    // SERVICE WORKER REGISTRATION (CORRECT PLACE)
    if ("serviceWorker" in navigator) {
      navigator.serviceWorker.register("service-worker.js")
        .then(() => console.log("Service Worker Registered"))
        .catch(err => console.error("SW failed", err));
    }
  </script>

</body>
</html>
