<!DOCTYPE html>
<html>
<head>
  <title>Patient Card</title>
  <link rel="stylesheet" href="css/main.css">
</head>
<body>

<header>
  <img src="assets/logo.png">
  <button onclick="logout()">Logout</button>
</header>

<div class="container">

<div class="card">
  <h3>Patient: <span id="pid"></span></h3>
</div>

<div class="card">
  <button onclick="loadVisit(1)">Visit 1</button>
  <button onclick="loadVisit(2)">Visit 2</button>
  <button onclick="loadVisit(3)">Visit 3</button>
  <button onclick="loadVisit(4)">Visit 4</button>
  <button onclick="loadVisit(5)">Visit 5</button>
</div>

<div class="card" id="visit"></div>

</div>

<script src="js/auth.js"></script>
<script src="js/db.js"></script>
<script src="js/visits.js"></script>

<script>
requireAuth();

const pid = sessionStorage.getItem("pid");
document.getElementById("pid").innerText = pid;

openDB();

async function loadVisit(no) {
  const v = await getVisit(pid, no);
  visit.innerHTML = `
    <h4>${v.visitName}</h4>
    <textarea id="notes">${v.data.notes || ""}</textarea>
    <button onclick="save(${no})">Save</button>
    <p>Status: ${v.status}</p>
  `;
}

async function save(no) {
  const v = await getVisit(pid, no);
  v.data.notes = notes.value;
  v.status = "Completed";
  update("visits", v);
  alert("Saved");
}
</script>

</body>
</html>
