<!DOCTYPE html>
<html>
<head>
  <title>Patients</title>
  <link rel="stylesheet" href="css/patient.css">
</head>
<body>

<h3>Add Patient</h3>

<input id="age" placeholder="Age">
<select id="gender"><option>Male</option><option>Female</option></select>
<select id="ethnicity">
  <option>Asian</option><option>Caucasian</option>
</select>

<button onclick="addPatient()">Generate Card</button>

<table id="list"></table>

<script src="js/db.js"></script>
<script src="js/auth.js"></script>
<script src="js/permissions.js"></script>

<script>
requireAuth();
openDatabase().then(load);

function addPatient() {
  if (!canEdit()) return alert("No permission");

  const p = {
    id: crypto.randomUUID(),
    age: age.value,
    gender: gender.value,
    ethnicity: ethnicity.value,
    status: "Active",
    study: "CLP-001"
  };

  add("patients", p).then(load);
}

function load() {
  getAll("patients").then(p => {
    list.innerHTML = p.map(x =>
      `<tr>
        <td>${x.id}</td>
        <td>${x.status}</td>
        <td><button onclick="openCard('${x.id}')">Open</button></td>
      </tr>`
    ).join("");
  });
}

function openCard(id) {
  sessionStorage.setItem("pid", id);
  location.href = "patient-card.html";
}
</script>

</body>
</html>
